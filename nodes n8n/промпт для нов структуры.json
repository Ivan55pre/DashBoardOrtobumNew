
в JsonRS.json - данные, которые поступают на вход code n8n JS: Code_Ishodn.json
минимально измени код JS для нового формата входящего json.
изменилось:
- входные данные не таблица, а дерево.
- на входе нет account_id/parent_account_id, а есть НомерПоПорядку - уникальный для каждого элемента
- account_id и parent_account_id должны появиться в payload (понадобятся в других алгоритмах)
- элемент, где "Организация": null и "organization_name": "Всеорганизации" - нужны только для постраения иерархии и не должны попадать в итоговый payload. (возможно, можно использовать их, как узлы уровня-0)

(
только минимально измени исходный код:
- Замени использование children → на Строки.
- Убери зависимость от account_id/parent_account_id, но и генерируй node_id/parent_node_id с именами колонок account_id/parent_account_id, соответственно, вместо node_id/parent_node_id и добавь их в payload.
- Нормализуй типы и названия полей level/Уровень.
- Добавь в payload «человеческие» пути path/path_names


измени код json так, чтобы элемент где "Организация": null использовался, как корневой узел (если необходимо), но числовые значения этого элемента в payload раны 0
)

давно

давай глобально изменим код и структуру данных.
текстовые поля оставим для работы пользователя, а всю логику иерархии перенесем на новые поля:
account_id (string), parent_account_id (string). Так как name может совпадать, а id - уникален.
Эти account_id, parent_account_id добавь новыми полями во входящий json. (я смогу их предоставить из внешней 1С).
соответственно измени код CashBankReport, upsert_cash_bank_report, useReportItems.ts, Code zagruz cash_bank_report_items.json и других, связанных объектов.
